<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeggiePrice - Sri Lankan Wholesale Market Prices</title>

    <!-- Primary SEO meta -->
    <meta name="description" content="VeggiePrice provides daily wholesale vegetable prices from major Sri Lankan markets (Dambulla, Nuwara Eliya, Pettah). Updated daily to help farmers and buyers make informed decisions.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://veggieprice.example.org/">

    <!-- Open Graph / Social -->
    <meta property="og:site_name" content="VeggiePrice">
    <meta property="og:title" content="VeggiePrice - Sri Lankan Wholesale Market Prices">
    <meta property="og:description" content="Daily wholesale vegetable prices from major Sri Lankan markets. Updated daily.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="assets/imgs/og-image.png">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Structured data (JSON-LD) for basic SEO signals -->
    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "VeggiePrice",
      "url": "https://veggieprice.example.org/",
      "description": "Daily wholesale vegetable prices from major Sri Lankan markets (Dambulla, Nuwara Eliya, Pettah).",
      "inLanguage": "en"
    }</script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts: Inter & Noto Sans Sinhala -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Sinhala:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Replace bucket-like favicon with a neutral inline SVG favicon to avoid emoji-like icon on minimize -->
    <link rel="icon" type="image/png" href="assets\imgs\favicon (3).png">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Default to English font */
            background: linear-gradient(135deg, #fdfbf7 0%, #ffffff 50%, #f0fdf4 100%);
            background-attachment: fixed;
            color: #374151;
            /* gray-700 */
            overflow-x: hidden;
            position: relative;
            padding-top: -100px !important;
        }

        /* --- SINHALA TYPOGRAPHY RULES (CRITICAL FIXES) --- */
        body.lang-si {
            font-family: 'Noto Sans Sinhala', sans-serif !important;
        }

        /* More breathing room for Sinhala headings */
        body.lang-si h1,
        body.lang-si h2,
        body.lang-si h3,
        body.lang-si .hero-title {
            line-height: 1.5 !important;
            /* Increase vertical space */
            font-weight: 600 !important;
            /* Semi-bold instead of Bold */
            letter-spacing: 0.01em;
        }

        /* Adjust visual weight of large headings */
        body.lang-si .hero-title {
            font-size: 2.2rem !important;
            /* Slightly smaller than English to fix balance */
        }

        @media (min-width: 768px) {
            body.lang-si .hero-title {
                font-size: 3rem !important;
            }
        }

        /* Better paragraph flow */
        body.lang-si p {
            line-height: 1.7 !important;
            font-weight: 400;
        }

        body.lang-si .text-xs {
            font-size: 0.8rem;
            /* Slightly larger small text for readability */
        }

        /* --- End Sinhala Rules --- */

        /* Smooth Fade In Animation */
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        nav {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 70px !important;
            /* Fixed height for stability */
            z-index: 50 !important;
            /* Higher than emoji bar */
            background: white;
            /* Ensure it's not transparent */
        }

        /* Modal Transition */
        .modal {
            transition: opacity 0.4s ease, visibility 0.4s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 50;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: scale(0.95) translateY(10px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            /* gray-300 */
            border-radius: 10px;
            border: 2px solid #fff;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* --- Floating Produce Animation Layer --- */
        #floating-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            /* Let clicks pass through to main content */
            z-index: 0;
            overflow: hidden;
        }

        .produce-icon {
            position: absolute;
            font-size: 2rem;
            opacity: 0;
            user-select: none;
            pointer-events: auto;
            /* Re-enable pointer events for the icons themselves */
            cursor: help;
            transition: transform 0.3s, opacity 0.3s, filter 0.3s;
            z-index: 5;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.05));
        }

        .produce-icon:hover {
            opacity: 1 !important;
            transform: scale(1.25) !important;
            z-index: 20;
            animation-play-state: paused;
            /* Stop moving on hover */
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.1));
        }

        @keyframes floatUp {
            0% {
                transform: translateY(110vh) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.7;
            }

            33% {
                transform: translateY(70vh) translateX(25px) rotate(10deg);
            }

            66% {
                transform: translateY(30vh) translateX(-25px) rotate(-10deg);
            }

            90% {
                opacity: 0.7;
            }

            100% {
                transform: translateY(-20vh) translateX(0) rotate(360deg);
                opacity: 0;
            }
        }

        /* Tooltip Styling */
        .produce-tooltip {
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: #166534;
            padding: 10px 16px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.8);
            z-index: 30;
        }

        .produce-icon:hover .produce-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .price-highlight {
            color: #ea580c;
            font-weight: 800;
            display: block;
            margin-top: 4px;
            font-size: 0.95em;
        }

        /* Price Legend Box */
        .legend-box {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 40;
            transition: all 0.3s ease;
        }

        /* Subtle glow for hero */
        .hero-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(240, 253, 244, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* Highlighter / marker underline for hero 'Vegetable' */
        .hero-title .highlight-pen {
            position: relative;
            display: inline-block;
        }

        .hero-title .highlight-pen svg {
            position: absolute;
            left: 0;
            bottom: -0.5rem;
            width: 100%;
            height: 1.2rem;
            transform-origin: center;
            transform: rotate(-2deg);
            pointer-events: none;
            z-index: -1;
        }

        .hero-title .highlight-pen path {
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 6px 6px rgba(16, 185, 129, 0.12));
            transition: transform 0.3s ease;
        }

        @media (max-width: 767px) {
            .hero-title .highlight-pen svg {
                height: 0.9rem;
                bottom: -0.35rem;
            }

            /* Position the market action (arrow) higher on mobile cards */
            .market-card {
                position: relative;
            }

            .market-card .market-action-mobile {
                position: absolute;
                right: 12px;
                top: 195px; /* move the arrow up; increase value to push it further up */
                z-index: 30;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .market-card .market-action-mobile button {
                width: 24px;
                height: 24px;
            }
        }

        /* Nature Section Animations */
        @keyframes slowZoom {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .animate-slow-zoom {
            animation: slowZoom 20s infinite alternate linear;
        }

        /* Small nudge for hero left column to sit slightly higher */
        .hero-left {
            transform: translateY(-8px);
        }

        @media (min-width: 768px) {
            .hero-left {
                transform: translateY(-18px);
            }
        }


        /* EXCEPTION: Keep the main Brand Logo orange */
        #brand-logo-container i {
            color: #f97316 !important;
            /* orange-500 */
        }

        i.fa-solid:not(.fa-carrot),
        i.fa-regular,
        i.fa-brands {
            color: #15803d !important;
            /* green-700 */
        }

        #emoji-interaction-panel.hidden-bar {
            transform: translateY(-100%);
            /* Moves up by its own height */
            z-index: 30;
            /* Drops behind nav */
        }

        /* LOADER */
        #loader {
            position: fixed;
            inset: 0;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 42px;
            height: 42px;
            border: 4px solid #e5e7eb;
            border-top-color: #1f7a4d;
            border-radius: 50%;
            animation: spin 0.9s linear infinite;
            margin-bottom: 12px;
        }

        #loader p {
            font-size: 14px;
            color: #64748b;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Emoji Nav Button Styles */
        #emoji-toggle-nav-btn {
            border: none;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        #emoji-toggle-nav-btn .carrot-emoji {
            font-size: 1.15rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 9999px;
        }

        #emoji-toggle-nav-btn.active .carrot-emoji {
            animation: pulse 1.2s infinite ease-in-out;
            transform-origin: center;
        }

        #emoji-toggle-nav-btn.pressed {
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
        }

        /* Ripple element */
        .emoji-ripple {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 9999px;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.08);
            pointer-events: none;
            opacity: 0.9;
        }

        @keyframes ripple {
            to {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0;
            }
        }

        .emoji-ripple.animate {
            animation: ripple 420ms cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Mobile floating button (hidden on md+) */
        #emoji-toggle-mobile {
            display: none;
            position: relative;
            overflow: hidden;
        }

        #emoji-toggle-mobile.pressed {
            transform: translateY(1px) scale(0.98);
        }

        /* Mobile nav emoji button (visible only on small screens) */
        #emoji-toggle-nav-mobile {
            border: none;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        #emoji-toggle-nav-mobile .carrot-emoji {
            font-size: 1.15rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 9999px;
        }

        /* Shared active/pulsing animation for mobile/desktop emoji buttons */
        #emoji-toggle-nav-mobile.active .carrot-emoji,
        #emoji-toggle-mobile.active .carrot-emoji,
        #emoji-toggle-nav-btn.active .carrot-emoji {
            animation: pulse 1.2s infinite ease-in-out;
            transform-origin: center;
        }

        #emoji-toggle-nav-mobile.pressed,
        #emoji-toggle-mobile.pressed {
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
        }

        @media (max-width: 767px) {
            #emoji-toggle-mobile {
                display: flex;
            }

            #emoji-toggle-nav-btn {
                display: none;
            }

            .produce-icon {
                font-size: 1.4rem;
            }

            .falling-emoji,
            .boom-emoji {
                font-size: 22px;
            }
        }

        /* Falling and Boom emoji styles */
        .falling-emoji,
        .boom-emoji {
            position: fixed;
            pointer-events: none;
            z-index: 60;
            font-size: 28px;
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.12));
        }

        @keyframes fallDown {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes boom {
            0% {
                transform: scale(0.6) rotate(0deg);
                opacity: 1;
            }

            40% {
                transform: scale(1.6) rotate(180deg);
                opacity: 1;
            }

            100% {
                transform: scale(2) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<div id="loader">
    <div class="spinner"></div>
    <p>Loading VeggiePrice‚Ä¶</p>
</div>

<body class="flex flex-col min-h-screen">

    <!-- Floating Background Layer -->
    <div id="floating-container"></div>

    <!-- Mobile Floating Emoji Button (visible on small screens) -->
    <button id="emoji-toggle-mobile" aria-pressed="true" title="Emoji fun" onclick="emojiController.handleClick(event)"
        class="md:hidden fixed bottom-6 right-4 z-50 w-14 h-14 rounded-full bg-white flex items-center justify-center shadow-lg">
        <span class="text-2xl" aria-hidden="true">ü•ï</span>
    </button>

    <!-- === TELEGRAM-STYLE EMOJI INTERACTION SECTION === -->



    <!-- Sidebar Panel -->
    <div id="emoji-interaction-panel">

        <div class="text-[10px] uppercase font-bold text-green-700 tracking-wider">

        </div>

        <div class="flex items-center" id="emoji-veg-list">
        </div>

        <div class="h-6 w-px bg-green-200"></div>

        <div class="flex items-center" id="emoji-fruit-list">
        </div>

    </div>



    <!-- Navigation -->
    <nav
        class="sticky top-0 z-40 relative border-b border-gray-200 bg-white/95 backdrop-blur-md shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div id="brand-logo-container" class="flex items-center space-x-2 cursor-pointer group"
                onclick="app.goHome()">
                <i
                    class="fa-solid fa-carrot text-orange-500 text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                <h1 class="text-2xl font-bold tracking-wide text-green-800">VeggiePrice</h1>
            </div>

            <div class="flex items-center gap-4">
                <!-- Language Toggle Button -->
                <button onclick="app.toggleLanguage()"
                    class="bg-gray-50 hover:bg-gray-100 px-4 py-1.5 rounded-full text-xs font-bold border border-gray-200 text-gray-700 hover:text-green-700 hover:border-green-200 transition-all shadow-sm flex items-center gap-2">
                    <span id="lang-icon" class="text-base">üá±üá∞</span> <span id="lang-text"
                        class="tracking-wide">SINHALA</span>
                </button>

                <div class="hidden md:flex items-center space-x-8 text-sm font-semibold text-gray-600">
                    <button onclick="app.goHome()" class="hover:text-green-600 transition"
                        data-i18n="nav_home">Home</button>
                    <button onclick="app.scrollToSection('markets')" class="hover:text-green-600 transition"
                        data-i18n="nav_markets">Markets</button>
                    <button onclick="app.toggleAbout()" class="hover:text-green-600 transition"
                        data-i18n="nav_about">About</button>
                    <button id="emoji-toggle-nav-btn" aria-pressed="true" title="Emoji fun"
                        onclick="emojiController.handleClick(event)"
                        class="ml-2 rounded-full transition transform hover:scale-105 flex items-center justify-center text-sm"
                        style="width:40px;height:40px;background:#fff;border:0;padding:0;box-shadow:0 6px 18px rgba(0,0,0,0.06);">
                        <span class="rounded-full bg-orange-100 p-2 carrot-emoji" aria-hidden="true">ü•ï</span>
                    </button>
                </div>

                <button
                    class="md:hidden text-gray-600 focus:outline-none ml-2 p-2 hover:bg-gray-100 rounded-lg transition"
                    onclick="app.toggleMobileMenu()">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu"
            class="hidden bg-white/95 backdrop-blur-md md:hidden pb-4 px-4 transition-all border-t border-gray-100 shadow-lg absolute w-full left-0">
            <a href="#" onclick="app.goHome(); app.toggleMobileMenu()"
                class="block py-4 text-gray-600 hover:text-green-600 border-b border-gray-50 font-medium"
                data-i18n="nav_home">Home</a>
            <a href="#" onclick="app.scrollToSection('markets'); app.toggleMobileMenu()"
                class="block py-4 text-gray-600 hover:text-green-600 border-b border-gray-50 font-medium"
                data-i18n="nav_markets">Markets</a>
            <a href="#" onclick="app.toggleAbout(); app.toggleMobileMenu()"
                class="block py-4 text-gray-600 hover:text-green-600 font-medium" data-i18n="nav_about">About</a>
            <button onclick="emojiController.handleClick(event); app.toggleMobileMenu()"
                class="w-full text-left py-4 text-gray-600 hover:text-green-600 font-medium flex items-center gap-3">
                <span class="bg-orange-100 p-2 rounded-full">ü•ï</span> Emoji Fun
            </button>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow relative z-10">

        <!-- View 1: Landing & Markets Grid -->
        <section id="view-home" class="fade-in">

            <!-- Hero Section -->
            <div class="relative bg-gradient-to-b from-white to-green-50/50 pt-12 pb-16 border-b border-gray-100">
                <div class="container mx-auto px-6 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center pl-4 md:pl-24">

                    <!-- Left: Content -->
                    <div class="text-left space-y-6 z-10 hero-left">
                        <!-- Micro-Trust Signals & Update Time -->
                        <div class="flex flex-col gap-2 mb-2">
                            <div class="flex flex-wrap gap-2">
                                <span
                                    class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full flex items-center border border-green-200"><i
                                        class="fa-solid fa-check-circle mr-1.5"></i> <span
                                        data-i18n="trust_daily">Updated Daily</span></span>
                                <span
                                    class="bg-blue-50 text-blue-700 text-xs font-bold px-3 py-1 rounded-full flex items-center border border-blue-100">üá±üá∞
                                    <span data-i18n="trust_sl">Sri Lankan Wholesale</span></span>
                            </div>
                            <!-- Kind Update Message -->
                            <div class="text-xs text-gray-500 italic flex items-center">
                                <i class="fa-regular fa-clock mr-1.5"></i> <span data-i18n="update_time_msg">Prices
                                    update between 11:00 AM - 1:00 PM daily.</span>
                            </div>
                        </div>

                        <h2 class="hero-title text-4xl md:text-6xl font-bold text-gray-900 leading-tight tracking-tight"
                            data-i18n="hero_title">
                            Daily Wholesale <span class="highlight-pen text-green-700 relative inline-block">Vegetable
                                <svg class="absolute w-full h-5 -bottom-2 left-0 -z-10" viewBox="0 0 120 24"
                                    preserveAspectRatio="none" aria-hidden="true">
                                    <path d="M6 16 Q40 4 114 14" stroke="#bbf7d0" stroke-width="14" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round" opacity="0.98"></path>
                                </svg>
                            </span> Prices
                        </h2>

                        <p class="text-lg text-gray-600 font-light max-w-lg leading-relaxed" data-i18n="hero_subtitle">
                            Access daily wholesale vegetable prices directly from Dambulla, Nuwara Eliya, and Pettah. We
                            provide real-time, accurate market updates to help farmers and consumers make smarter buying
                            and selling decisions.
                        </p>

                        <div class="flex items-center gap-4 pt-2">
                            <div
                                class="inline-flex items-center bg-white px-5 py-2.5 rounded-full shadow-sm border border-green-200 text-sm">
                                <span class="relative flex h-2.5 w-2.5 mr-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                </span>
                                <span class="text-gray-500 mr-2 font-medium" data-i18n="updated_label">Updated:</span>
                                <span id="last-updated-text" class="font-bold text-green-700">Today</span>
                            </div>
                        </div>

                        <!-- Thank Govt Message -->
                        <p class="text-xs text-green-600/70 font-medium" data-i18n="thank_govt">Special thanks to
                            Department of Agriculture for price data.</p>
                    </div>

                    <!-- Right: Visual -->
                    <div class="relative hidden lg:block z-10">
                        <div class="hover:rotate-0 transition-transform duration-700">
                            <img src="assets\imgs\women.jpg.png" alt="Market">
                            <div class></div>

                            <!-- Floating Tag (With Dynamic Price ID) -->

                        </div>
                    </div>
                </div>

                <!-- Scroll Hint -->
                <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-1 cursor-pointer opacity-70 hover:opacity-100 transition"
                    onclick="app.scrollToSection('stats-section')">
                    <span class="text-xs font-semibold text-gray-400 uppercase tracking-widest">Scroll</span>
                    <i class="fa-solid fa-chevron-down text-green-500 animate-bounce"></i>
                </div>
            </div>

            <!-- "Today at a Glance" Stats Section -->
            <section id="stats-section" class="py-10 bg-white relative z-10 border-b border-gray-100">
                <div class="container mx-auto px-6 pl-4 md:pl-24">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fa-solid fa-chart-line text-green-500 mr-2"></i> <span data-i18n="stats_title">Today
                            at a Glance</span>
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Stat Card 1 (Dynamic Price ID) -->
                        <div
                            class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition hover:-translate-y-1 group">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 group-hover:scale-110 transition">
                                    <i class="fa-solid fa-arrow-up-right-dots text-xs"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider"
                                    data-i18n="stat_highest">Highest</span>
                            </div>
                            <div class="font-bold text-gray-800 text-lg" data-i18n="stat_item_carrot">Carrot</div>
                            <div class="text-xs text-green-600 font-semibold">Rs. <span
                                    id="stat-price-carrot">250</span> <span class="text-gray-300"
                                    data-i18n="unit_kg">/kg</span></div>
                        </div>
                        <!-- Stat Card 2 -->
                        <div
                            class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition hover:-translate-y-1 group">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 group-hover:scale-110 transition">
                                    <i class="fa-solid fa-arrow-down text-xs"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider"
                                    data-i18n="stat_dropped">Dropped</span>
                            </div>
                            <div class="font-bold text-gray-800 text-lg" data-i18n="stat_item_tomato">Tomato</div>
                            <div class="text-xs text-green-600 font-semibold">- Rs. 40 <span class="text-gray-300"
                                    data-i18n="text_today">today</span></div>
                        </div>
                        <!-- Stat Card 3 -->
                        <div
                            class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition hover:-translate-y-1 group">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition">
                                    <i class="fa-solid fa-fire text-xs"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider"
                                    data-i18n="stat_trending">Trending</span>
                            </div>
                            <div class="font-bold text-gray-800 text-lg" data-i18n="stat_item_onion">Big Onion</div>
                            <div class="text-xs text-green-600 font-semibold" data-i18n="stat_high_demand">High Demand
                            </div>
                        </div>
                        <!-- Stat Card 4 -->
                        <div
                            class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition hover:-translate-y-1 group">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition">
                                    <i class="fa-regular fa-clock text-xs"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider"
                                    data-i18n="stat_time">Time</span>
                            </div>
                            <div class="font-bold text-gray-800 text-lg">06:30 AM</div>
                            <div class="text-xs text-green-600 font-semibold" data-i18n="stat_latest">Latest Update
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market Selection Grid (compact, professional) -->
            <div id="markets" class="bg-green-50/50 py-6 md:py-8">
                <div class="container mx-auto px-4 sm:px-6 pl-4 md:pl-12">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-xl md:text-3xl font-bold text-gray-800" data-i18n="select_market">Select a
                                Market</h3>
                            <p class="text-gray-600 mt-1 text-sm max-w-xl" data-i18n="market_subtitle">Choose a location
                                to view detailed price lists.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4 items-start justify-items-center"
                        id="market-grid">
                        <!-- Market Cards injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Nature Protection Section -->
            <div class="py-16 bg-white">
                <div class="container mx-auto px-6 pl-4 md:pl-24">
                    <div id="nature-section"
                        class="relative w-full rounded-[2.5rem] overflow-hidden shadow-2xl h-[450px] group">
                        <div class="absolute inset-0 z-0">
                            <img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1920&auto=format&fit=crop"
                                class="w-full h-full object-cover animate-slow-zoom" alt="Nature Background">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-black/30"></div>
                        </div>

                        <div class="relative z-10 h-full flex flex-col items-center justify-center text-center px-6">
                            <div
                                class="bg-white/10 backdrop-blur-md border border-white/20 p-8 md:p-12 rounded-3xl max-w-4xl w-full transform transition hover:scale-105 duration-500">
                                <div
                                    class="inline-block p-3 bg-green-500/20 rounded-full mb-4 backdrop-blur-sm border border-green-400/30">
                                    <i class="fa-solid fa-leaf text-3xl text-green-300"></i>
                                </div>
                                <h2 class="text-3xl md:text-5xl font-bold text-white mb-8 font-noto tracking-tight drop-shadow-lg"
                                    data-i18n="nature_title">Protect Nature, Preserve Life</h2>
                                <div id="nature-advice-container" class="h-24 flex items-center justify-center">
                                    <p id="nature-advice-text"
                                        class="text-xl md:text-3xl text-green-100 font-medium italic transition-all duration-700 transform">
                                        "Reduce plastic waste in our markets."
                                    </p>
                                </div>
                                <div id="nature-dots" class="flex justify-center gap-3 mt-8"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- View 2: Specific Market Details -->
        <section id="view-market" class="hidden fade-in container mx-auto px-6 pl-4 md:pl-24 py-10">
            <!-- Breadcrumb / Back Button -->
            <div class="mb-8 flex items-center">
                <button onclick="app.goHome()"
                    class="flex items-center text-gray-500 hover:text-green-600 font-medium transition bg-white/80 backdrop-blur-sm px-5 py-2.5 rounded-full shadow-sm border border-gray-200 hover:border-green-100 group">
                    <i
                        class="fa-solid fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform text-gray-400 group-hover:text-green-500"></i>
                    <span data-i18n="back_markets">Back to Markets</span>
                </button>
            </div>

            <!-- Market Header -->
            <div
                class="bg-white rounded-[0.75rem] md:rounded-[1.5rem] shadow-none md:shadow-sm border border-gray-100 p-2 md:p-6 mb-4 md:mb-8 flex flex-col md:flex-row items-center md:items-start gap-2 md:gap-4 relative overflow-hidden">
                <div
                    class="absolute top-0 right-0 w-16 h-16 md:w-48 md:h-48 bg-green-50 rounded-full blur-3xl -mr-12 -mt-12 md:-mr-24 md:-mt-24 opacity-30 pointer-events-none">
                </div>
                <img id="detail-market-img" src="" alt="Market"
                    class="w-10 h-10 md:w-20 md:h-20 object-cover rounded-md md:rounded-xl border-2 border-gray-100 shadow-none md:shadow-sm z-10">
                <div class="text-center md:text-left z-10">
                    <h2 id="detail-market-name" class="text-base md:text-2xl font-bold text-gray-900 mb-0 md:mb-1">Market Name</h2>
                    <p
                        class="text-gray-500 text-xs md:text-sm font-medium flex items-center justify-center md:justify-start bg-gray-50 inline-block px-2 py-0.5 md:px-3 md:py-1 rounded-md md:rounded-lg">
                        <i class="fa-solid fa-location-dot text-red-400 mr-2"></i><span
                            id="detail-market-loc">Location</span>
                    </p>
                    <p class="text-xs md:text-sm text-gray-400 mt-3 md:mt-4 max-w-md leading-relaxed" data-i18n="market_desc">Browse the
                        latest wholesale price lists below.</p>
                </div>
            </div>

            <!-- Current Prices Section -->
            <div class="mb-12">
                <div class="flex items-center justify-between mb-8 px-2 border-b border-gray-100 pb-4">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <span class="bg-yellow-100 p-2 rounded-lg mr-3"><i
                                class="fa-solid fa-bolt text-yellow-500"></i></span>
                        <span data-i18n="recent_updates">Recent Updates</span>
                    </h3>
                    <span
                        class="text-xs font-bold bg-green-50 text-green-700 px-4 py-2 rounded-full border border-green-100 shadow-sm"
                        data-i18n="last_3_days">Last 3 Days</span>
                </div>
                <div id="recent-prices-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                <!-- Note: no-recent-msg logic is handled by JS now -->
            </div>

            <!-- Past Prices Toggle -->
            <div class="border-t border-gray-100 pt-10">
                <button onclick="app.togglePastPrices()"
                    class="w-full flex justify-between items-center bg-white hover:bg-gray-50 p-6 rounded-2xl transition-all duration-300 border border-gray-200 hover:border-gray-300 shadow-sm group">
                    <span class="font-semibold text-gray-500 group-hover:text-gray-700 transition flex items-center"
                        data-i18n="view_past">
                        <i class="fa-solid fa-history mr-3 text-gray-300 group-hover:text-green-400"></i>
                        View Past Prices (Older than 3 days)
                    </span>
                    <i id="past-arrow"
                        class="fa-solid fa-chevron-down text-gray-300 transition-transform group-hover:text-gray-500 bg-gray-100 p-2 rounded-full"></i>
                </button>
                <div id="past-prices-container" class="hidden mt-8">
                    <div id="past-prices-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                </div>
            </div>
        </section>

        <!-- About Modal -->
        <div id="about-overlay"
            class="fixed inset-0 bg-white/60 hidden z-50 flex items-center justify-center p-4 backdrop-blur-lg transition-all duration-300"
            onclick="app.toggleAbout()">
            <div class="bg-white rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.1)] p-8 max-w-md w-full relative border border-white"
                onclick="event.stopPropagation()">
                <button onclick="app.toggleAbout()"
                    class="absolute top-5 right-5 text-gray-300 hover:text-gray-500 transition p-1 hover:bg-gray-50 rounded-full">
                    <i class="fa-solid fa-xmark text-2xl"></i>
                </button>
                <div class="text-center mb-8">
                    <div class="inline-block p-4 bg-green-50 rounded-2xl mb-4">
                        <i class="fa-solid fa-leaf text-3xl text-green-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" data-i18n="about_title">About VeggiePrice</h3>
                </div>
                <p class="text-gray-600 mb-4 leading-relaxed text-center font-light" data-i18n="about_text_1">
                    VeggiePrice is a community project dedicated to bringing transparency to vegetable wholesale prices
                    in Sri Lanka.
                </p>
                <p class="text-gray-600 mb-8 text-center text-sm font-medium" data-i18n="about_text_2">
                    We manually update price lists from major economic centers including Dambulla, Nuwara Eliya, and
                    Pettah.
                </p>
                <div class="text-xs text-center text-gray-400 border-t border-gray-50 pt-6">
                    Version 1.6.0 ‚Ä¢ Advanced Dates
                </div>
            </div>
        </div>

    </main>

    <!-- Price Legend Widget -->
    <div id="price-legend" class="legend-box group">
        <button onclick="floatingFx.toggleLegend()"
            class="bg-white/90 backdrop-blur-md text-gray-700 font-bold py-3 pl-4 pr-5 rounded-full shadow-[0_8px_30px_rgb(0,0,0,0.08)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.15)] transition-all duration-300 flex items-center gap-3 border border-white hover:scale-105">
            <span class="text-xl bg-orange-100 p-1.5 rounded-full">üè∑Ô∏è</span>
            <span class="hidden group-hover:inline-block md:inline-block text-sm" data-i18n="todays_rates">Today's
                Rates</span>
            <i class="fa-solid fa-chevron-up text-xs text-gray-400"></i>
        </button>
        <div id="legend-content"
            class="hidden bg-white/90 backdrop-blur-xl rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.1)] border border-white p-5 absolute bottom-16 right-0 w-72 origin-bottom-right transition-all">
            <h4
                class="text-sm font-bold text-gray-800 border-b border-gray-100/50 pb-3 mb-2 flex justify-between items-center">
                <span data-i18n="sample_prices">Sample Wholesale</span>
                <i class="fa-solid fa-xmark cursor-pointer text-gray-300 hover:text-red-400 transition p-1 hover:bg-gray-100 rounded"
                    onclick="floatingFx.toggleLegend()"></i>
            </h4>
            <ul class="text-xs space-y-1 max-h-56 overflow-y-auto pr-1 custom-scrollbar" id="legend-list">
                <!-- Injected via JS -->
            </ul>
        </div>
    </div>

    <!-- Why Use VeggiePrice Section -->
    <section id="why-veggieprice" class="bg-gradient-to-b from-white to-green-50/40 py-16 border-t border-gray-100">
        <div class="container mx-auto px-6 pl-4 md:pl-24">
            <div class="max-w-4xl mx-auto text-center space-y-6">
                <h3 class="text-3xl font-bold text-gray-900" data-i18n="why_title">Why use VeggiePrice?</h3>
                <p class="text-gray-600 max-w-2xl mx-auto" data-i18n="why_subtitle">Get reliable daily wholesale prices
                    directly from major Sri Lankan markets, so farmers and buyers can make smarter decisions.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-6">
                    <div class="flex items-start gap-4">
                        <div class="bg-green-50 p-3 rounded-full text-green-600 text-xl"><i
                                class="fa-solid fa-check"></i></div>
                        <div>
                            <p class="font-semibold text-gray-800" data-i18n="why_point_1">Daily verified updates from
                                local markets</p>
                            <p class="text-sm text-gray-500" data-i18n="why_point_1_sub">Sourced and checked for
                                accuracy.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-green-50 p-3 rounded-full text-green-600 text-xl"><i
                                class="fa-solid fa-chart-line"></i></div>
                        <div>
                            <p class="font-semibold text-gray-800" data-i18n="why_point_2">Easy-to-read prices & trends
                            </p>
                            <p class="text-sm text-gray-500" data-i18n="why_point_2_sub">Quick snapshots to guide
                                decisions.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-green-50 p-3 rounded-full text-green-600 text-xl"><i
                                class="fa-solid fa-users"></i></div>
                        <div>
                            <p class="font-semibold text-gray-800" data-i18n="why_point_3">Built for farmers & buyers
                            </p>
                            <p class="text-sm text-gray-500" data-i18n="why_point_3_sub">Practical tools designed
                                locally.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-green-50 p-3 rounded-full text-green-600 text-xl"><i
                                class="fa-solid fa-shield-halved"></i></div>
                        <div>
                            <p class="font-semibold text-gray-800" data-i18n="why_point_4">Transparent and
                                community-driven</p>
                            <p class="text-sm text-gray-500" data-i18n="why_point_4_sub">Open and accountable data
                                sharing.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <button onclick="app.scrollToSection('markets')"
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-full font-semibold shadow-sm transition"
                        data-i18n="why_cta">Explore Markets</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Professional Footer (Added ID for Scroll Logic) -->
    <footer id="main-footer" class="bg-gray-900 text-gray-300 pt-16 pb-8 relative z-20">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <!-- Brand -->
                <div class="col-span-1 md:col-span-1">
                    <div class="flex items-center space-x-2 mb-4">
                        <i class="fa-solid fa-carrot text-orange-500 text-2xl"></i>
                        <h2 class="text-2xl font-bold text-white tracking-wide">VeggiePrice</h2>
                    </div>
                    <p class="text-gray-400 text-sm leading-relaxed mb-6" data-i18n="footer_desc">
                        Empowering Sri Lankan farmers and consumers with transparent, daily wholesale market data.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#"
                            class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-green-600 hover:text-white transition"><i
                                class="fa-brands fa-facebook-f text-sm"></i></a>
                        <a href="#"
                            class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-blue-400 hover:text-white transition"><i
                                class="fa-brands fa-twitter text-sm"></i></a>
                        <a href="#"
                            class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-pink-600 hover:text-white transition"><i
                                class="fa-brands fa-instagram text-sm"></i></a>
                    </div>
                </div>
                <!-- ... Footer Links ... -->
                <div>
                    <h3 class="text-white font-bold mb-6 text-sm uppercase tracking-wider" data-i18n="footer_quick">
                        Quick Links</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#" onclick="app.goHome(); return false;"
                                class="text-gray-400 hover:text-green-400 transition" data-i18n="nav_home">Home</a></li>
                        <li><a href="#" onclick="app.scrollToSection('markets'); return false;"
                                class="text-gray-400 hover:text-green-400 transition"
                                data-i18n="nav_markets">Markets</a></li>
                        <li><a href="#" onclick="app.toggleAbout(); return false;"
                                class="text-gray-400 hover:text-green-400 transition" data-i18n="nav_about">About Us</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white font-bold mb-6 text-sm uppercase tracking-wider" data-i18n="footer_support">
                        Support</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-green-400 transition"
                                data-i18n="privacy">Privacy Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white font-bold mb-6 text-sm uppercase tracking-wider" data-i18n="footer_contact">
                        Contact</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-start">
                            <i class="fa-solid fa-location-dot mt-1 mr-3 text-green-500"></i>
                            <span class="text-gray-400">Colombo, Sri Lanka</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa-solid fa-envelope mr-3 text-green-500"></i>
                            <span class="text-gray-400">hello@veggieprice.lk</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
                <p>&copy; 2025 VeggiePrice Sri Lanka. <span data-i18n="footer_rights">All rights reserved.</span></p>
            </div>
        </div>
    </footer>

    <!-- Image Viewer Modal -->
    <div id="image-modal"
        class="modal fixed inset-0 bg-stone-900/95 flex items-center justify-center p-4 md:p-8 backdrop-blur-md"
        onclick="app.closeModal()">
        <button
            class="absolute top-6 right-6 text-white hover:text-red-400 z-50 transition p-3 bg-white/10 hover:bg-white/20 rounded-full w-12 h-12 flex items-center justify-center backdrop-blur-md border border-white/10">
            <i class="fa-solid fa-xmark text-2xl"></i>
        </button>
        <div class="modal-content relative max-w-4xl w-full max-h-screen flex flex-col items-center justify-center"
            onclick="event.stopPropagation()">
            <div
                class="bg-white/10 backdrop-blur-md text-white px-6 py-3 rounded-full mb-6 flex items-center space-x-4 shadow-2xl border border-white/20">
                <span id="modal-market-name" class="font-bold text-green-300 text-lg">Market</span>
                <span class="w-1.5 h-1.5 bg-white/50 rounded-full"></span>
                <span id="modal-date" class="text-sm text-gray-200">Date</span>
            </div>
            <img id="modal-image" src="" alt="Price List"
                class="max-w-full max-h-[80vh] object-contain rounded-xl shadow-2xl border border-white/10 bg-black"
                onerror="this.src='https://placehold.co/600x800/f3f4f6/374151?text=Image+Load+Error'">
            <p class="text-gray-400 text-xs mt-6 font-light">Tap anywhere outside to close</p>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>

        // --- 1. CENTRALIZED PRICE CONFIGURATION (Edit prices here) ---
        const marketRates = {
            carrot: 250,
            tomato: 200,
            potato: 180,
            onion: 380,
            cabbage: 160,
            corn: 90,
            brinjal: 180,
            chili: 700,
            broccoli: 900,
            garlic: 600,
            pumpkin: 100,
            cucumber: 120,
            mushroom: 400,
            bellpepper: 800,
            greens: 80,
            apple: 900,
            banana: 140,
            mango: 300,
            watermelon: 150,
            orange: 800,
            lemon: 450,
            pineapple: 200,
            grapes: 1200,
            pear: 950,
            coconut: 100,
            strawberry: 1500,
            cherry: 2000,
            peach: 1100,
            kiwi: 1300,
            avocado: 400
        };

        // --- 2. FLOATING ITEM CONFIG ---
        const produceItems = [
            { id: "item_Tomato", icon: "üçÖ", key: "tomato" },
            { id: "item_Carrot", icon: "ü•ï", key: "carrot" },
            { id: "item_Banana", icon: "üçå", key: "banana" },
            { id: "item_Apple", icon: "üçé", key: "apple" },
            { id: "item_Cabbage", icon: "ü•¨", key: "cabbage" },
            { id: "item_GreenChili", icon: "üå∂Ô∏è", key: "chili" },
            { id: "item_BigOnion", icon: "üßÖ", key: "onion" },
            { id: "item_Potato", icon: "ü•î", key: "potato" },
            { id: "item_Mango", icon: "ü•≠", key: "mango" },
            { id: "item_Beans", icon: "ü´ò", key: "greens" },
            { id: "item_Pumpkin", icon: "üéÉ", key: "pumpkin" },
            { id: "item_Brinjal", icon: "üçÜ", key: "brinjal" },
            { id: "item_Lime", icon: "üçã", key: "lemon" },
            { id: "item_Papaya", icon: "üçà", key: "avocado" },
            { id: "item_LeafyGreens", icon: "üçÉ", key: "greens" },
        ];

        // --- 3. CENTRALIZED MARKET IMAGES (Edit recent images here) ---
        let priceDataMap = {}; // Filled by generateDemoData for preview

        // Helper for Date String
        function getDateStr(daysOffset) {
            const date = new Date();
            date.setDate(date.getDate() - daysOffset);
            return date.toISOString().split('T')[0];
        }

        // --- TRANSLATIONS (i18n) ---
        const translations = {
            en: {
                nav_home: "Home",
                nav_markets: "Markets",
                nav_about: "About",
                hero_title: "Daily Wholesale Vegetable Prices",
                site_title: "VeggiePrice - Sri Lankan Wholesale Market Prices",
                meta_description: "VeggiePrice provides daily wholesale vegetable prices from major Sri Lankan markets (Dambulla, Nuwara Eliya, Pettah). Updated daily to help farmers and buyers make informed decisions.",
                hero_highlight: "Vegetable",
                hero_subtitle: "Access daily wholesale vegetable prices directly from Dambulla, Nuwara Eliya, and Pettah. We provide real-time, accurate market updates to help farmers and consumers make smarter buying and selling decisions.",
                updated_label: "Updated:",
                today_text: "Today",
                yesterday_text: "Yesterday",
                days_ago: "Days Ago",
                select_market: "Select a Market",
                view_prices: "View Prices",
                back_markets: "Back to Markets",
                market_desc: "Browse the latest wholesale price lists below.",
                recent_updates: "Recent Updates",
                last_3_days: "Last 3 Days",
                no_updates: "No updates in the last 3 days.",
                view_past: "View Past Prices (Older than 3 days)",
                about_title: "About VeggiePrice",
                about_text_1: "VeggiePrice is a community project dedicated to bringing transparency to vegetable wholesale prices in Sri Lanka.",
                about_text_2: "We manually update price lists from major economic centers including Dambulla, Nuwara Eliya, and Pettah.",
                todays_rates: "Today's Rates",
                sample_prices: "Sample Wholesale",
                privacy: "Privacy",
                contact: "Contact",
                zoom_hint: "Tap to view list",
                nature_title: "Protect Nature, Preserve Life",

                // Trust & Stats
                trust_daily: "Updated Daily",
                trust_sl: "Sri Lankan Wholesale",
                stats_title: "Today at a Glance",
                stat_highest: "Highest",
                stat_dropped: "Dropped",
                stat_trending: "Trending",
                stat_time: "Time",
                stat_latest: "Latest Update",
                stat_high_demand: "High Demand",
                market_subtitle: "Choose a location to view detailed price lists.",
                update_time_msg: "Prices update between 11:00 AM - 1:00 PM daily.",
                thank_govt: "Special thanks to Department of Agriculture for price data.",

                // Updates
                msg_pending: "Update Pending (11am-1pm)",

                // Footer
                footer_desc: "Empowering Sri Lankan farmers and consumers with transparent, daily wholesale market data.",
                footer_quick: "Quick Links",
                footer_support: "Support",
                footer_contact: "Contact",
                footer_rights: "All rights reserved.",
                why_title: "Why use VeggiePrice?",
                why_subtitle: "Get reliable daily wholesale prices directly from major Sri Lankan markets, so farmers and buyers can make smarter decisions.",
                why_point_1: "Daily verified updates from local markets",
                why_point_1_sub: "Sourced and checked for accuracy.",
                why_point_2: "Easy-to-read prices & trends",
                why_point_2_sub: "Quick snapshots to guide decisions.",
                why_point_3: "Built for farmers & buyers",
                why_point_3_sub: "Practical tools designed locally.",
                why_point_4: "Transparent and community-driven",
                why_point_4_sub: "Open and accountable data sharing.",
                why_cta: "Explore Markets",

                // Stats Items
                stat_item_carrot: "Carrot",
                stat_item_tomato: "Tomato",
                stat_item_onion: "Big Onion",
                unit_kg: "/kg",
                text_today: "today",

                item_Tomato: "Tomato",
                item_Carrot: "Carrot",
                item_Banana: "Banana",
                item_Apple: "Apple",
                item_Cabbage: "Cabbage",
                item_GreenChili: "Green Chili",
                item_BigOnion: "Big Onion",
                item_Potato: "Potato",
                item_Mango: "Mango",
                item_Beans: "Beans",
                item_Pumpkin: "Pumpkin",
                item_Brinjal: "Brinjal",
                item_Lime: "Lime",
                item_Papaya: "Papaya",
                item_LeafyGreens: "Leafy Greens"
            },
            si: {
                nav_home: "‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä",
                nav_markets: "‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω",
                nav_about: "‡∂Ö‡∂¥ ‡∂ú‡∑ê‡∂±",
                // Shorter, simpler copy for modern feel
                hero_title: "‡∂Ö‡∂Ø ‡∂ë‡∑Ö‡∑Ä‡∑Ö‡∑î ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω",
                site_title: "VeggiePrice - ‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω",
                meta_description: "VeggiePrice ‡∑Ä‡∑í‡∑É‡∑í‡∂±‡∑ä ‡∂Ø‡∂π‡∑î‡∂Ω‡∑ä‡∂Ω, ‡∂±‡∑î‡∑Ä‡∂ª‡∂ë‡∑Ö‡∑í‡∂∫ ‡∑É‡∑Ñ ‡∂¥‡∑í‡∂ß‡∂ö‡∑ú‡∂ß‡∑î‡∑Ä ‡∂á‡∂≠‡∑î‡∑Ö‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω‡∑Ä‡∂Ω ‡∂Ø‡∑õ‡∂±‡∑í‡∂ö ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑ö. ‡∂ú‡∑ú‡∑Ä‡∑ì‡∂±‡∑ä ‡∑É‡∑Ñ ‡∂¥‡∑è‡∂ª‡∑í‡∂∑‡∑ù‡∂ú‡∑í‡∂ö‡∂∫‡∑í‡∂±‡∑ä‡∂ß ‡∑Ñ‡∑ú‡∂≥ ‡∂≠‡∑ì‡∂ª‡∂´ ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂ã‡∂¥‡∂ö‡∑è‡∂ª‡∑ì ‡∑Ä‡∑ö.",
                hero_highlight: "‡∂ë‡∑Ö‡∑Ä‡∑Ö‡∑î",
                hero_subtitle: "‡∂Ø‡∂π‡∑î‡∂Ω‡∑ä‡∂Ω, ‡∂±‡∑î‡∑Ä‡∂ª‡∂ë‡∑Ö‡∑í‡∂∫ ‡∑Ñ‡∑è ‡∂¥‡∑í‡∂ß‡∂ö‡∑ú‡∂ß‡∑î‡∑Ä ‡∂Ü‡∂ª‡∑ä‡∂Æ‡∑í‡∂ö ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∑É‡∑ò‡∂¢‡∑î‡∑Ä ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂±‡∑è ‡∂Ø‡∑õ‡∂±‡∑í‡∂ö ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω. ‡∂Ö‡∂¥‡∑í ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∑Ñ‡∑è ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂ú‡∑ú‡∑Ä‡∑ì‡∂±‡∑ä‡∂ß ‡∑É‡∑Ñ ‡∂∏‡∑í‡∂Ω‡∂Ø‡∑ì‡∂ú‡∂±‡∑ä‡∂±‡∂±‡∑ä‡∂ß ‡∂â‡∂ö‡∑ä‡∂∏‡∂±‡∑ä ‡∂≠‡∑ì‡∂ª‡∂´ ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂ã‡∂¥‡∂ö‡∑è‡∂ª ‡∂ö‡∂ª‡∂∏‡∑î.",
                updated_label: "‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä:",
                today_text: "‡∂Ö‡∂Ø",
                yesterday_text: "‡∂ä‡∂∫‡∑ö",
                days_ago: "‡∂Ø‡∑í‡∂±‡∂ö‡∂ß ‡∂¥‡∑ô‡∂ª",
                select_market: "‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±",
                view_prices: "‡∂∏‡∑í‡∂Ω ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±",
                back_markets: "‡∂Ü‡∂¥‡∑É‡∑î",
                market_desc: "‡∂±‡∑Ä‡∂≠‡∂∏ ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î.",
                recent_updates: "‡∂±‡∑Ä ‡∂∏‡∑í‡∂Ω",
                last_3_days: "‡∂¥‡∑É‡∑î‡∂ú‡∑í‡∂∫ ‡∂Ø‡∑í‡∂± 3",
                no_updates: "‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.",
                view_past: "‡∂¥‡∑ê‡∂ª‡∂´‡∑í ‡∂∏‡∑í‡∂Ω ‡∂ú‡∂´‡∂±‡∑ä",
                about_title: "VeggiePrice ‡∂ú‡∑ê‡∂±",
                about_text_1: "VeggiePrice ‡∂∫‡∂±‡∑î ‡∂ë‡∑Ö‡∑Ä‡∑Ö‡∑î ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω ‡∂ú‡∂´‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑Ä‡∑í‡∂±‡∑í‡∑Ä‡∑í‡∂Ø‡∂∑‡∑è‡∑Ä‡∂∫‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∑ñ ‡∑Ä‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∑ò‡∂≠‡∑í‡∂∫‡∂ö‡∑í.",
                about_text_2: "‡∂Ø‡∂π‡∑î‡∂Ω‡∑ä‡∂Ω, ‡∂±‡∑î‡∑Ä‡∂ª‡∂ë‡∑Ö‡∑í‡∂∫ ‡∑É‡∑Ñ ‡∂¥‡∑í‡∂ß‡∂ö‡∑ú‡∂ß‡∑î‡∑Ä ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∂∏‡∑í‡∂Ω ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂∏‡∑î.",
                todays_rates: "‡∂Ö‡∂Ø ‡∂∏‡∑í‡∂Ω",
                sample_prices: "‡∑É‡∑è‡∂∏‡∑ä‡∂¥‡∂Ω ‡∂∏‡∑í‡∂Ω",
                privacy: "‡∂ª‡∑Ñ‡∑É‡∑ä‚Äç‡∂∫‡∂≠‡∑è",
                contact: "‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞",
                zoom_hint: "‡∑Ä‡∑í‡∑Å‡∑è‡∂Ω ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß",
                nature_title: "‡∂¥‡∂ª‡∑í‡∑É‡∂ª‡∂∫ ‡∑É‡∑î‡∂ª‡∂ö‡∑í‡∂∏‡∑î",

                // Trust & Stats (Conversational)
                trust_daily: "‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂±‡∂∫‡∑í",
                trust_sl: "‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂≠‡∑ú‡∂ú ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω",
                stats_title: "‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω ‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫",
                stat_highest: "‡∑Ä‡∑ê‡∂©‡∑í‡∂∏ ‡∂∏‡∑í‡∂Ω",
                stat_dropped: "‡∂∏‡∑í‡∂Ω ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑ñ",
                stat_trending: "‡∂â‡∑Ñ‡∑Ö ‡∂â‡∂Ω‡∑ä‡∂Ω‡∑î‡∂∏",
                stat_time: "‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä",
                stat_latest: "‡∂±‡∑Ä‡∂≠‡∂∏ ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂±",
                stat_high_demand: "‡∂â‡∑Ñ‡∑Ö ‡∂â‡∂Ω‡∑ä‡∂Ω‡∑î‡∂∏‡∂ö‡∑ä",
                market_subtitle: "‡∂∏‡∑í‡∂Ω ‡∂ú‡∂´‡∂±‡∑ä ‡∂∂‡∑ê‡∂Ω‡∑ì‡∂∏‡∂ß ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±.",
                update_time_msg: "‡∂∏‡∑í‡∂Ω ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏: ‡∂¥‡∑ô.‡∑Ä. 11 - ‡∂¥.‡∑Ä. 1",
                thank_govt: "‡∂ª‡∑è‡∂¢‡∑ä‚Äç‡∂∫ ‡∂ö‡∑ò‡∑Ç‡∑í‡∂ö‡∂ª‡∑ä‡∂∏ ‡∂Ö‡∂∏‡∑è‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂Ç‡∑Å‡∂∫‡∂ß ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç ‡∑É‡∑ä‡∂≠‡∑ñ‡∂≠‡∑í‡∂∫.",

                // Updates
                msg_pending: "‡∂≠‡∑Ä‡∂∏ ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠",

                // Footer
                footer_desc: "‡∂ú‡∑ú‡∑Ä‡∑ì‡∂±‡∑ä ‡∑É‡∑Ñ ‡∂¥‡∑è‡∂ª‡∑í‡∂∑‡∑ù‡∂ú‡∑í‡∂ö‡∂∫‡∑í‡∂±‡∑ä ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∑í‡∑Å‡∑ä‡∑Ä‡∑è‡∑É‡∑Ä‡∂±‡∑ä‡∂≠ ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î.",
                footer_support: "‡∑É‡∑Ñ‡∑è‡∂∫",
                footer_contact: "‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±",
                footer_rights: "‡∑É‡∑í‡∂∫‡∂Ω‡∑î ‡∑Ñ‡∑í‡∂∏‡∑í‡∂ö‡∂∏‡∑ä ‡∂á‡∑Ä‡∑í‡∂ª‡∑í‡∂´‡∑í.",
                why_title: "VeggiePrice ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑Ö ‡∂∫‡∑î‡∂≠‡∑ä‡∂≠‡∑ö ‡∂á‡∂∫‡∑í?",
                why_subtitle: "‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è ‡∑Ä‡∑í‡∑Å‡∑ä‡∑Ä‡∑è‡∑É‡∂Ø‡∑è‡∂∫‡∑ì ‡∂≠‡∑ú‡∂ú ‡∂∏‡∑í‡∂Ω ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ô‡∂± ‡∂ú‡∑ú‡∑Ä‡∑ì‡∂±‡∑ä ‡∑Ñ‡∑è ‡∂∏‡∑í‡∂Ω‡∂Ø‡∑ì‡∂ú‡∂±‡∑ä‡∂±‡∂±‡∑ä‡∂ß ‡∑Ñ‡∑ú‡∂≥ ‡∂≠‡∑ì‡∂ª‡∂´ ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂ã‡∂¥‡∂ö‡∑è‡∂ª‡∑ì ‡∑Ä‡∑ö.",
                why_point_1: "‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è ‡∑É‡∑Ñ‡∂≠‡∑í‡∂ö ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂±",
                why_point_1_sub: "‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∑í‡∂ö ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∑É‡∂∏‡∑ä‡∂¥‡∑ä‚Äç‡∂ª‡∑ö‡∑Ç‡∂´ ‡∑Ä‡∑ö.",
                why_point_2: "‡∑É‡∂ª‡∂Ω ‡∂∏‡∑í‡∂Ω ‡∑É‡∑Ñ ‡∂ª‡∑ê‡∑Ö‡∑í ‡∂Ø‡∂ª‡∑ä‡∑Å‡∂±",
                why_point_2_sub: "‡∂â‡∂ö‡∑ä‡∂∏‡∂±‡∑ä ‡∂≠‡∑ì‡∂ª‡∂´ ‡∂ú‡∂±‡∑ä‡∂± ‡∂¥‡∑Ñ‡∑É‡∑î.",
                why_point_3: "‡∂ú‡∑ú‡∑Ä‡∑ì‡∂±‡∑ä ‡∑É‡∑Ñ ‡∂∏‡∑í‡∂Ω‡∂Ø‡∑ì‡∂ú‡∂±‡∑ä‡∂±‡∂±‡∑ä ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫",
                why_point_3_sub: "‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂∫‡∑ù‡∂ú‡∑í‡∂ö, ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∂∏‡∑ô‡∑Ä‡∂Ω‡∂∏‡∑ä.",
                why_point_4: "‡∑Ä‡∑í‡∑Ä‡∑ò‡∂≠ ‡∑É‡∑Ñ ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∑Ä‡∂ß ‡∂∫‡∑ú‡∂∏‡∑î‡∑Ä‡∑ñ",
                why_point_4_sub: "‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂¥‡∑ê‡∑Ñ‡∑ê‡∂Ø‡∑í‡∂Ω‡∑í ‡∑Ñ‡∑è ‡∑Ä‡∂ú‡∂ö‡∑í‡∑Ä‡∂∫‡∑î‡∂≠‡∑î‡∂∫‡∑í.",
                why_cta: "‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω‡∑ä ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±",

                // Stats Items
                stat_item_carrot: "‡∂ö‡∑ê‡∂ª‡∂ß‡∑ä",
                stat_item_tomato: "‡∂≠‡∂ö‡∑ä‡∂ö‡∑è‡∂Ω‡∑í",
                stat_item_onion: "‡∂Ω‡∑ú‡∂ö‡∑î ‡∂Ω‡∑ñ‡∂±‡∑î",
                unit_kg: "/‡∂ö‡∑í‡∂Ω‡∑ù",
                text_today: "‡∂Ö‡∂Ø",

                item_Tomato: "‡∂≠‡∂ö‡∑ä‡∂ö‡∑è‡∂Ω‡∑í",
                item_Carrot: "‡∂ö‡∑ê‡∂ª‡∂ß‡∑ä",
                item_Banana: "‡∂ö‡∑ô‡∑É‡∑ô‡∂Ω‡∑ä",
                item_Apple: "‡∂á‡∂¥‡∂Ω‡∑ä",
                item_Cabbage: "‡∂ú‡∑ù‡∑Ä‡∑è",
                item_GreenChili: "‡∂Ö‡∂∏‡∑î ‡∂∏‡∑í‡∂ª‡∑í‡∑É‡∑ä",
                item_BigOnion: "‡∂Ω‡∑ú‡∂ö‡∑î ‡∂Ω‡∑ñ‡∂±‡∑î",
                item_Potato: "‡∂Ö‡∂Ω",
                item_Mango: "‡∂Ö‡∂π",
                item_Beans: "‡∂∂‡∑ù‡∂Ç‡∂†‡∑í",
                item_Pumpkin: "‡∑Ä‡∂ß‡∑ä‡∂ß‡∂ö‡∑ä‡∂ö‡∑è",
                item_Brinjal: "‡∑Ä‡∂∏‡∑ä‡∂∂‡∂ß‡∑î",
                item_Lime: " ‡∂Ø‡∑ô‡∑Ñ‡∑í",
                item_Papaya: "‡∂¥‡∑ê‡∂¥‡∑ú‡∂Ω‡∑ä",
                item_LeafyGreens: "‡∂¥‡∂Ω‡∑è ‡∑Ä‡∂ª‡∑ä‡∂ú"
            }
        };

        const natureAdvice = {
            en: ["Reduce plastic usage in markets.", "Support organic farming practices.", "Keep our water sources clean.", "Minimize food waste.", "Plant a tree for every harvest."],
            si: ["‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∂Ω‡∑ö ‡∂¥‡∑ä‡∂Ω‡∑è‡∑É‡∑ä‡∂ß‡∑í‡∂ö‡∑ä ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∂∫ ‡∂Ö‡∑Ä‡∂∏ ‡∂ö‡∂ª‡∂∏‡∑î.", "‡∂ö‡∑è‡∂∂‡∂±‡∑í‡∂ö ‡∂ú‡∑ú‡∑Ä‡∑í‡∂≠‡∑ê‡∂±‡∂ß ‡∑É‡∑Ñ‡∑è‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑î.", "‡∂¢‡∂Ω ‡∂∏‡∑ñ‡∂Ω‡∑è‡∑Å‡∑ä‚Äç‡∂ª ‡∂¥‡∑í‡∂ª‡∑í‡∑É‡∑í‡∂Ø‡∑î‡∑Ä ‡∂≠‡∂∂‡∑è ‡∂ú‡∂±‡∑í‡∂∏‡∑î.", "‡∂Ü‡∑Ñ‡∑è‡∂ª ‡∂±‡∑è‡∑É‡∑ä‡∂≠‡∑í‡∂∫ ‡∂Ö‡∑Ä‡∂∏ ‡∂ö‡∂ª‡∂∏‡∑î.", "‡∂Ö‡∑É‡∑ä‡∑Ä‡∑ê‡∂±‡∑ä‡∂±‡∂ö‡∑ä ‡∂¥‡∑è‡∑É‡∑è ‡∂¥‡∑ê‡∑Ö‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂ß‡∑î‡∑Ä‡∂∏‡∑î."]
        };

        const markets = [
            { id: 'dambulla', name: 'Dambulla DEC', nameSi: '‡∂Ø‡∂π‡∑î‡∂Ω‡∑ä‡∂Ω ‡∂Ü‡∂ª‡∑ä‡∂Æ‡∑í‡∂ö ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫', location: 'Matale District', locationSi: '‡∂∏‡∑è‡∂≠‡∂Ω‡∑ö ‡∂Ø‡∑í‡∑É‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∑í‡∂ö‡∑ä‡∂ö‡∂∫', image: 'assets//imgs//keppetipola market.png' },
            { id: 'nuwaraeliya', name: 'Nuwara Eliya DEC', nameSi: '‡∂±‡∑î‡∑Ä‡∂ª‡∂ë‡∑Ö‡∑í‡∂∫ ‡∂Ü‡∂ª‡∑ä‡∂Æ‡∑í‡∂ö ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫', location: 'Nuwara Eliya', locationSi: '‡∂±‡∑î‡∑Ä‡∂ª‡∂ë‡∑Ö‡∑í‡∂∫', image: 'assets//imgs//keppetipola market.png' },
            { id: 'thambuttegama', name: 'Thambuttegama DEC', nameSi: '‡∂≠‡∂π‡∑î‡∂≠‡∑ä‡∂≠‡∑ö‡∂ú‡∂∏ ‡∂Ü‡∂ª‡∑ä‡∂Æ‡∑í‡∂ö ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫', location: 'Anuradhapura', locationSi: '‡∂Ö‡∂±‡∑î‡∂ª‡∑è‡∂∞‡∂¥‡∑î‡∂ª', image: 'assets//imgs//keppetipola market.png' },
            { id: 'bandarawela', name: 'Bandarawela', nameSi: '‡∂∂‡∂´‡∑ä‡∂©‡∑è‡∂ª‡∑Ä‡∑ô‡∂Ω', location: 'Badulla', locationSi: '‡∂∂‡∂Ø‡∑î‡∂Ω‡∑ä‡∂Ω', image: 'assets//imgs//keppetipola market.png' },
            { id: 'keppetipola', name: 'Keppetipola DEC', nameSi: '‡∂ö‡∑ê‡∂¥‡∑ä‡∂¥‡∑ô‡∂ß‡∑í‡∂¥‡∑ú‡∂Ω ‡∂Ü‡∂ª‡∑ä‡∂Æ‡∑í‡∂ö ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫', location: 'Keppetipola', locationSi: '‡∂ö‡∑ê‡∂¥‡∑ä‡∂¥‡∑ô‡∂ß‡∑í‡∂¥‡∑ú‡∂Ω', image: 'assets//imgs//keppetipola market.png' }
        ];

        // --- APPLICATION LOGIC ---

        const app = {
            currentLang: 'en',
            adviceInterval: null,
            adviceIndex: 0,

            init: () => {
                app.generateDemoData();
                app.renderMarkets();

                // --- 1. Load Saved View State ---
                const savedState = sessionStorage.getItem('vp_view_state');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    if (state.view === 'market' && state.id) {
                        app.showMarket(state.id, true); // true = restoring
                    } else {
                        // Default Home View
                        // Restore Home Scroll immediately if on home
                        const savedScroll = sessionStorage.getItem('vp_home_scroll');
                        if (savedScroll) {
                            // Small timeout to allow DOM paint
                            setTimeout(() => window.scrollTo(0, parseInt(savedScroll)), 10);
                        }
                    }
                } else {
                    // Check URL params fallback
                    const urlParams = new URLSearchParams(window.location.search);
                    const marketParam = urlParams.get('market');
                    if (marketParam) {
                        app.showMarket(marketParam, false);
                    }
                }

                // --- 2. Restore Refresh Scroll Position ---
                // If the user refreshed, we want them to stay exactly where they were
                // regardless of view.
                const refreshScroll = sessionStorage.getItem('vp_refresh_scroll');
                if (refreshScroll) {
                    setTimeout(() => window.scrollTo(0, parseInt(refreshScroll)), 20);
                    sessionStorage.removeItem('vp_refresh_scroll'); // Clean up
                }

                app.updateDynamicPrices();
                floatingFx.init();
                emojiInteraction.init(); emojiController.init();
                app.updateTranslations();
                app.startNatureCarousel();

                // Add Scroll Saver for Refresh
                window.addEventListener('beforeunload', () => {
                    sessionStorage.setItem('vp_refresh_scroll', window.scrollY);
                });
            },

            // Create sample map for preview logic
            generateDemoData: () => {
                const today = getDateStr(0);
                const yesterday = getDateStr(1);
                const day2 = getDateStr(2);
                const day4 = getDateStr(4);
                const day10 = getDateStr(10);

                priceDataMap = {};

                priceDataMap[today] = {
                    'dambulla': 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?auto=format&fit=crop&w=600&q=80',
                    'nuwaraeliya': 'https://images.unsplash.com/photo-1488459716781-31db52582fe9?auto=format&fit=crop&w=600&q=80',
                    'keppetipola': 'assets/Keppetipola/kep12-18.jpg'
                };

                priceDataMap[yesterday] = {
                    'dambulla': 'https://images.unsplash.com/photo-1450101499121-87b3a061b04a?auto=format&fit=crop&w=600&q=80',
                    'nuwaraeliya': 'https://images.unsplash.com/photo-1597362925123-77861d3fbac7?auto=format&fit=crop&w=600&q=80',
                    'thambuttegama': 'https://images.unsplash.com/photo-1598155523122-38423bb4d6c1?auto=format&fit=crop&w=600&q=80'

                };

                priceDataMap[day2] = {
                    'dambulla': 'https://images.unsplash.com/photo-1529312266912-b33cf6227e2f?auto=format&fit=crop&w=600&q=80',
                    'thambuttegama': 'https://images.unsplash.com/photo-1598155523122-38423bb4d6c1?auto=format&fit=crop&w=600&q=80'
                };

                priceDataMap[day4] = { 'dambulla': 'https://images.unsplash.com/photo-1585561817730-81765c3b9b33?auto=format&fit=crop&w=600&q=80' };
                priceDataMap[day10] = { 'dambulla': 'https://images.unsplash.com/photo-1585561817730-81765c3b9b33?auto=format&fit=crop&w=600&q=80' };
            },

            updateDynamicPrices: () => {
                const heroPrice = document.getElementById('hero-price-carrot');
                if (heroPrice) heroPrice.textContent = marketRates.carrot;

                const statPrice = document.getElementById('stat-price-carrot');
                if (statPrice) statPrice.textContent = marketRates.carrot;
            },

            startNatureCarousel: () => {
                const updateAdvice = () => {
                    const adviceList = natureAdvice[app.currentLang];
                    const textEl = document.getElementById('nature-advice-text');
                    const dotsContainer = document.getElementById('nature-dots');

                    if (!textEl || !dotsContainer) return;

                    textEl.style.opacity = '0';
                    textEl.style.transform = 'translateY(10px)';

                    setTimeout(() => {
                        textEl.textContent = `"${adviceList[app.adviceIndex]}"`;
                        textEl.style.opacity = '1';
                        textEl.style.transform = 'translateY(0)';
                    }, 300);

                    dotsContainer.innerHTML = adviceList.map((_, i) => `
                        <div class="h-1.5 rounded-full transition-all duration-300 ${i === app.adviceIndex ? 'w-8 bg-green-400' : 'w-2 bg-white/30'}"></div>
                    `).join('');

                    app.adviceIndex = (app.adviceIndex + 1) % adviceList.length;
                };

                updateAdvice();
                if (app.adviceInterval) clearInterval(app.adviceInterval);
                app.adviceInterval = setInterval(updateAdvice, 4000);
            },

            toggleLanguage: () => {
                app.currentLang = app.currentLang === 'en' ? 'si' : 'en';
                const body = document.body;

                const btnText = document.getElementById('lang-text');
                const btnIcon = document.getElementById('lang-icon');
                if (app.currentLang === 'en') {
                    btnText.textContent = "SINHALA";
                    btnIcon.textContent = "üá±üá∞";
                    body.classList.remove('lang-si');
                } else {
                    btnText.textContent = "ENGLISH";
                    btnIcon.textContent = "üá∫üá∏";
                    body.classList.add('lang-si');
                }

                app.updateTranslations();
                app.renderMarkets();
                floatingFx.init();
                emojiInteraction.init();
                app.startNatureCarousel();

                if (!document.getElementById('view-market').classList.contains('hidden')) {
                    const currentMarketName = document.getElementById('detail-market-name').dataset.id;
                    if (currentMarketName) app.showMarket(currentMarketName, true); // true keeps us on market view
                }
            },

            updateTranslations: () => {
                const t = translations[app.currentLang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    // Hero title uses inline HTML for the marker ‚Äî handle it separately
                    if (key === 'hero_title') return;
                    if (t[key]) el.textContent = t[key];
                });
                const lastUpdatedEl = document.getElementById('last-updated-text');
                if (lastUpdatedEl) lastUpdatedEl.textContent = t.today_text;

                // Update hero title with highlight preserved
                app.setHeroTitle();

                // Update page metadata for SEO & accessibility
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc && t.meta_description) metaDesc.setAttribute('content', t.meta_description);
                if (t.site_title) document.title = t.site_title;
                // Update html lang attribute for accessibility and SEO
                document.documentElement.setAttribute('lang', app.currentLang === 'en' ? 'en' : 'si');
            },

            setHeroTitle: () => {
                const el = document.querySelector('[data-i18n="hero_title"]');
                if (!el) return;
                const t = translations[app.currentLang];
                const title = t.hero_title || '';
                const highlight = t.hero_highlight || '';
                const highlightSVG = '<svg class="absolute w-full h-5 -bottom-2 left-0 -z-10" viewBox="0 0 120 24" preserveAspectRatio="none" aria-hidden="true"><path d="M6 16 Q40 4 114 14" stroke="#bbf7d0" stroke-width="14" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.98"></path></svg>';

                if (highlight && title.includes(highlight)) {
                    const wrapped = title.replace(highlight, `<span class="highlight-pen text-green-700 relative inline-block">${highlight}${highlightSVG}</span>`);
                    el.innerHTML = wrapped;
                } else {
                    el.textContent = title;
                }
            },

            goHome: () => {
                document.getElementById('view-home').classList.remove('hidden');
                document.getElementById('view-market').classList.add('hidden');

                // Update State
                sessionStorage.setItem('vp_view_state', JSON.stringify({ view: 'home' }));

                // Restore Home Scroll
                const savedScroll = sessionStorage.getItem('vp_home_scroll');
                if (savedScroll) {
                    window.scrollTo(0, parseInt(savedScroll));
                } else {
                    window.scrollTo(0, 0);
                }
            },

            scrollToSection: (id) => {
                const el = document.getElementById(id);
                if (el) {
                    // If we are in market view, go home first
                    if (!document.getElementById('view-market').classList.contains('hidden')) {
                        app.goHome();
                        // Small delay to allow home rendering
                        setTimeout(() => el.scrollIntoView({ behavior: 'smooth' }), 100);
                    } else {
                        el.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            },

            toggleMobileMenu: () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            },

            toggleAbout: () => {
                const overlay = document.getElementById('about-overlay');
                const wasHidden = overlay.classList.contains('hidden');
                overlay.classList.toggle('hidden');
                const isNowOpen = !overlay.classList.contains('hidden');
                if (isNowOpen) {
                    if (window.veggieHistory && typeof window.veggieHistory.pushViewState === 'function') {
                        window.veggieHistory.pushViewState('about', {}, '#about');
                    }
                } else {
                    // When user closes About via UI, pop the about history entry if present
                    if (history.state && history.state.app === 'veggie' && history.state.view === 'about') {
                        history.back();
                    }
                }
            },

            togglePastPrices: () => {
                const container = document.getElementById('past-prices-container');
                const arrow = document.getElementById('past-arrow');
                container.classList.toggle('hidden');

                if (container.classList.contains('hidden')) {
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    arrow.style.transform = 'rotate(180deg)';
                }
            },

            renderMarkets: () => {
                const grid = document.getElementById('market-grid');
                grid.innerHTML = markets.map(m => {
                    const name = app.currentLang === 'si' ? m.nameSi : m.name;
                    const loc = app.currentLang === 'si' ? m.locationSi : m.location;
                    const btnText = translations[app.currentLang].view_prices;

                    return `
                            <div onclick="app.showMarket('${m.id}')" onkeydown="if(event.key==='Enter') app.showMarket('${m.id}')" role="button" tabindex="0" aria-label="${btnText} - ${name}" class="group relative bg-white rounded-2xl md:rounded-3xl overflow-hidden border border-gray-100 shadow-none cursor-pointer transition transform duration-300 hover:scale-105 hover:shadow-2xl market-card h-auto md:h-[420px] flex flex-col self-start w-full">
                        <div class="h-28 md:h-[210px] overflow-hidden flex items-center justify-center">
  <img
    src="${m.image}" 
    alt="${name}" 
     class="w-32 h-32 object-contain object-center transition-transform duration-300 group-hover:scale-105 mx-auto"
    onerror="this.src='https://placehold.co/400x300?text=Market'"
  >
</div>

                        <div class="bg-white p-3 md:p-4 flex flex-col justify-between h-[120px] md:h-[210px]">
                            <div>
                                <h3 class="text-xs sm:text-sm md:text-lg md:text-xl font-semibold text-gray-900 leading-tight break-words md:min-h-[72px]">${name}</h3>
                                <p class="text-sm text-gray-600 mt-2 max-w-full break-words">${loc}</p>
                            </div>

                            <div class="mt-3 flex items-center">
                                <!-- Desktop/Tablet: full width text button -->
                                <div class="hidden md:block w-full">
                                    <button class="w-full bg-green-600 text-white rounded-full py-2 shadow text-sm font-semibold flex items-center justify-center" aria-label="${btnText} - ${name}">
                                        <span>${btnText} <span aria-hidden="true">‚Üí</span></span>
                                    </button>
                                </div>

                                <!-- Mobile: compact circular arrow aligned right -->
                                <div class="ml-auto md:hidden market-action-mobile">
                                    <button class="w-10 h-10 bg-black-600 text-white rounded-full flex items-center justify-center shadow" aria-label="${btnText} - ${name}">
                                        <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `}).join('');
            },

            showMarket: (marketId, isRestoring = false) => {
                const market = markets.find(m => m.id === marketId);
                if (!market) return;
                // Push a history entry so Android / browser back navigates within the SPA
                if (!isRestoring && window.veggieHistory && typeof window.veggieHistory.pushViewState === 'function') {
                    window.veggieHistory.pushViewState('market', { id: marketId }, '#market/' + marketId);
                }

                // --- SMART SCROLL SAVING ---
                // Only save home scroll if we are NOT restoring from a refresh (because restoring implies we handle scroll separately)
                // AND if the home view is currently active.
                const isHomeVisible = !document.getElementById('view-home').classList.contains('hidden');
                if (isHomeVisible && !isRestoring) {
                    sessionStorage.setItem('vp_home_scroll', window.scrollY);
                }

                document.getElementById('view-home').classList.add('hidden');
                document.getElementById('view-market').classList.remove('hidden');

                // Save View State
                sessionStorage.setItem('vp_view_state', JSON.stringify({ view: 'market', id: marketId }));

                const name = app.currentLang === 'si' ? market.nameSi : market.name;
                const loc = app.currentLang === 'si' ? market.locationSi : market.location;

                const nameEl = document.getElementById('detail-market-name');
                nameEl.textContent = name;
                nameEl.dataset.id = marketId;
                nameEl.className = `text-2xl md:text-5xl font-bold text-gray-900 mb-2 ${app.currentLang === 'si' ? 'hero-title' : ''}`;

                document.getElementById('detail-market-loc').textContent = loc;
                document.getElementById('detail-market-img').src = market.image;

                if (!isRestoring) {
                    window.scrollTo(0, 0);
                }

                const t = translations[app.currentLang];

                const todayStr = getDateStr(0);
                const yestStr = getDateStr(1);
                const day2Str = getDateStr(2);

                const recentCardsData = [
                    { date: todayStr, label: t.today_text, isToday: true },
                    { date: yestStr, label: t.yesterday_text, isToday: false },
                    { date: day2Str, label: (app.currentLang === 'si' ? `2 ${t.days_ago}` : `2 ${t.days_ago}`), isToday: false }
                ];

                let recentHTML = '';

                recentCardsData.forEach(slot => {
                    const dayData = priceDataMap[slot.date];
                    const imageUrl = dayData ? dayData[marketId] : null;

                    if (imageUrl) {
                        recentHTML += `
                        <div onclick="app.openModal('${imageUrl}', '${name}', '${slot.label}')" 
                             class="bg-white rounded-[1.5rem] shadow-sm border border-white hover:border-green-100 hover:shadow-[0_15px_30px_rgba(0,0,0,0.06)] transition-all duration-300 cursor-pointer overflow-hidden relative group z-20 hover:-translate-y-1">
                            ${slot.isToday ? '<span class="absolute top-3 right-3 bg-red-500/90 backdrop-blur-sm text-white text-[10px] font-bold px-3 py-1 rounded-full shadow-sm z-10 animate-pulse">' + slot.label + '</span>' : ''}
                            <div class="h-48 overflow-hidden bg-gray-50 relative">
                                <img src="${imageUrl}" class="w-full h-full object-cover opacity-95 group-hover:opacity-100 group-hover:scale-105 transition duration-500" onerror="this.src='https://placehold.co/400x300?text=No+Preview'">
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition flex items-center justify-center backdrop-blur-[2px] opacity-0 group-hover:opacity-100">
                                    <div class="bg-white/90 p-3 rounded-full shadow-lg transform scale-75 group-hover:scale-100 transition duration-300">
                                        <i class="fa-solid fa-magnifying-glass-plus text-green-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 md:p-4 text-center bg-white border-t border-gray-50">
                                 <div class="text-xs font-bold ${slot.isToday ? 'text-green-700' : 'text-gray-400'} uppercase tracking-wider mb-1 font-noto">
                                    <i class="fa-regular fa-calendar mr-1"></i> ${slot.label}
                                 </div>
                                 <div class="text-[10px] text-gray-400 font-noto group-hover:text-green-600 transition font-medium">${t.zoom_hint}</div>
                            </div>
                        </div>`;
                    } else if (slot.isToday) {
                        recentHTML += `
                        <div class="bg-gray-50 rounded-[1.5rem] border border-dashed border-gray-300 flex flex-col items-center justify-center p-6 text-center h-full min-h-[250px]">
                            <div class="w-12 h-12 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center mb-3 animate-pulse">
                                <i class="fa-solid fa-clock text-xl"></i>
                            </div>
                            <h4 class="text-gray-600 font-bold text-sm mb-1">${t.today_text}</h4>
                            <p class="text-xs text-gray-400 max-w-[120px] mx-auto leading-relaxed">${t.msg_pending}</p>
                        </div>`;
                    }
                });

                document.getElementById('recent-prices-grid').innerHTML = recentHTML;

                const pastImages = [];
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - 3);

                Object.keys(priceDataMap).forEach(dateStr => {
                    if (new Date(dateStr) < cutoffDate && priceDataMap[dateStr][marketId]) {
                        pastImages.push({
                            date: dateStr,
                            image: priceDataMap[dateStr][marketId]
                        });
                    }
                });

                pastImages.sort((a, b) => new Date(b.date) - new Date(a.date));
                const top5Past = pastImages.slice(0, 5);

                const pastHTML = top5Past.map(item => `
                    <div onclick="app.openModal('${item.image}', '${name}', '${item.date}')" 
                         class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition cursor-pointer overflow-hidden relative group">
                        <div class="h-40 overflow-hidden bg-gray-100 relative">
                            <img src="${item.image}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition">
                        </div>
                        <div class="p-3 text-center bg-white border-t border-gray-100">
                             <div class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">
                                <i class="fa-regular fa-calendar mr-1"></i> ${item.date}
                             </div>
                        </div>
                    </div>
                `).join('');

                document.getElementById('past-prices-grid').innerHTML = pastHTML;
                document.getElementById('past-prices-container').classList.add('hidden');
                document.getElementById('past-arrow').style.transform = 'rotate(0deg)';
            },

            openModal: (imageSrc, marketName, dateStr) => {
                // Push modal state so Android / browser back closes the modal
                if (window.veggieHistory && typeof window.veggieHistory.pushViewState === 'function') {
                    window.veggieHistory.pushViewState('modal', { type: 'image', src: imageSrc, marketName: marketName, dateStr: dateStr }, '#modal/image');
                }
                const modal = document.getElementById('image-modal');
                document.getElementById('modal-image').src = imageSrc;

                const nameEl = document.getElementById('modal-market-name');
                nameEl.textContent = marketName;
                if (app.currentLang === 'si') nameEl.classList.add('font-noto');
                else nameEl.classList.remove('font-noto');

                const dateEl = document.getElementById('modal-date');
                dateEl.textContent = dateStr;
                if (app.currentLang === 'si') dateEl.classList.add('font-noto');

                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            },

            closeModal: () => {
                const modal = document.getElementById('image-modal');
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };



        const floatingFx = {
            container: document.getElementById('floating-container'),
            maxIcons: window.innerWidth < 768 ? 6 : 15,
            activeIcons: 0,
            interval: null,

            init: () => {
                const t = translations[app.currentLang];
                const list = document.getElementById('legend-list');

                list.innerHTML = produceItems.map(p => {
                    const price = marketRates[p.key] || 0;
                    const min = price - 20;
                    const max = price + 20;

                    const localizedName = t[p.id] || p.key;

                    return `
                    <li class="flex justify-between items-center py-2.5 border-b border-gray-100/50 last:border-0 hover:bg-green-50/50 transition px-3 rounded-lg cursor-default group/item">
                        <span class="flex items-center gap-3">
                            <span class="text-lg filter drop-shadow-sm">${p.icon}</span> <span class="text-gray-600 font-noto text-xs font-semibold group-hover/item:text-green-700 transition-colors">${localizedName}</span>
                        </span>
                        <span class="font-bold text-orange-500 text-xs bg-orange-50 px-2 py-0.5 rounded-md">Rs.${min}-${max}</span>
                    </li>
                `}).join('');

                if (floatingFx.interval) floatingFx.stop();

                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) floatingFx.stop();
                    else floatingFx.start();
                });

                floatingFx.start();
            },

            start: () => {
                if (floatingFx.container.innerHTML === '') {
                    for (let i = 0; i < 3; i++) setTimeout(floatingFx.spawn, i * 500);
                }

                floatingFx.interval = setInterval(() => {
                    if (floatingFx.activeIcons < floatingFx.maxIcons) {
                        floatingFx.spawn();
                    }
                }, 2000);
            },

            stop: () => {
                clearInterval(floatingFx.interval);
            },

            spawn: () => {
                const item = produceItems[Math.floor(Math.random() * produceItems.length)];
                const t = translations[app.currentLang];
                const localizedName = t[item.id] || item.key;

                const price = marketRates[item.key] || 0;
                const min = price - 20;
                const max = price + 20;

                const el = document.createElement('div');
                el.classList.add('produce-icon');
                el.textContent = item.icon;

                const tooltip = document.createElement('div');
                tooltip.classList.add('produce-tooltip');
                if (app.currentLang === 'si') tooltip.classList.add('font-noto');

                tooltip.innerHTML = `
                    ${localizedName}
                    <span class="price-highlight">Rs. ${min} - ${max}</span>
                `;
                el.appendChild(tooltip);

                const leftPos = Math.random() * 90 + 5;
                const duration = Math.random() * 5 + 6;
                const delay = Math.random() * 2;

                el.style.left = `${leftPos}%`;
                el.style.animation = `floatUp ${duration}s ease-in-out ${delay}s forwards`;

                floatingFx.container.appendChild(el);
                floatingFx.activeIcons++;

                el.addEventListener('animationend', () => {
                    el.remove();
                    floatingFx.activeIcons--;
                });
            },

            toggleLegend: () => {
                const content = document.getElementById('legend-content');
                content.classList.toggle('hidden');
            }
        };

        // Emoji Interaction Controller (single/double/triple click behaviors)
        const emojiController = {
            enabled: true,
            clickCount: 0,
            timer: null,
            init() {
                this.btn = document.getElementById('emoji-toggle-nav-btn');
                this.mobileBtn = document.getElementById('emoji-toggle-mobile');
                this.mobileNavBtn = document.getElementById('emoji-toggle-nav-mobile');
                if (this.mobileBtn) this.mobileBtn.addEventListener('click', (e) => this.handleClick(e));
                if (this.mobileNavBtn) this.mobileNavBtn.addEventListener('click', (e) => this.handleClick(e));
                this.updateUI();
            },
            updateUI() {
                if (!this.btn && !this.mobileBtn && !this.mobileNavBtn) return;
                if (this.enabled) {
                    if (this.btn) { this.btn.classList.add('active'); this.btn.setAttribute('aria-pressed', 'true'); }
                    if (this.mobileBtn) { this.mobileBtn.classList.add('active'); this.mobileBtn.setAttribute('aria-pressed', 'true'); }
                    if (this.mobileNavBtn) { this.mobileNavBtn.classList.add('active'); this.mobileNavBtn.setAttribute('aria-pressed', 'true'); }
                } else {
                    if (this.btn) { this.btn.classList.remove('active'); this.btn.setAttribute('aria-pressed', 'false'); }
                    if (this.mobileBtn) { this.mobileBtn.classList.remove('active'); this.mobileBtn.setAttribute('aria-pressed', 'false'); }
                    if (this.mobileNavBtn) { this.mobileNavBtn.classList.remove('active'); this.mobileNavBtn.setAttribute('aria-pressed', 'false'); }
                }
            },
            handleClick(e) {
                e.preventDefault();
                // Immediate tactile feedback (ripple + press + vibration)
                this.showClickFeedback(e);
                this.clickCount++;
                if (this.timer) clearTimeout(this.timer);
                this.timer = setTimeout(() => {
                    if (this.clickCount === 1) this.singleClick();
                    else if (this.clickCount === 2) this.doubleClick();
                    else if (this.clickCount >= 3) this.tripleClick();
                    this.clickCount = 0;
                }, 300);
            },
            showClickFeedback(e) {
                try {
                    const btn = e.currentTarget || e.target.closest('button') || this.btn || this.mobileBtn;
                    if (!btn) return;
                    // pressed visual
                    btn.classList.add('pressed');
                    setTimeout(() => btn.classList.remove('pressed'), 200);
                    // ripple
                    const rect = btn.getBoundingClientRect();
                    const x = (e.clientX || (rect.left + rect.width / 2)) - rect.left;
                    const y = (e.clientY || (rect.top + rect.height / 2)) - rect.top;
                    const r = document.createElement('span');
                    r.className = 'emoji-ripple';
                    r.style.left = `${x}px`;
                    r.style.top = `${y}px`;
                    btn.appendChild(r);
                    // trigger animation after append
                    requestAnimationFrame(() => r.classList.add('animate'));
                    setTimeout(() => r.remove(), 520);
                    // vibration for supported devices
                    if (navigator.vibrate) navigator.vibrate(20);
                } catch (err) {
                    // ignore errors
                }
            },
            singleClick() {
                // Toggle animation on/off
                this.enabled = !this.enabled;
                if (this.enabled) floatingFx.start();
                else floatingFx.stop();
                this.updateUI();
            },
            doubleClick() {
                // Falling emojis
                for (let i = 0; i < 18; i++) {
                    setTimeout(() => this.spawnFalling(), i * 80);
                }
            },
            tripleClick() {
                // Booms
                for (let i = 0; i < 32; i++) {
                    setTimeout(() => this.spawnBoom(), i * 20);
                }
            },
            spawnFalling() {
                const icon = produceItems[Math.floor(Math.random() * produceItems.length)].icon;
                const el = document.createElement('div');
                el.className = 'falling-emoji';
                el.textContent = icon;
                el.style.left = `${Math.random() * 90 + 3}%`;
                const duration = 3 + Math.random() * 3;
                el.style.animation = `fallDown ${duration}s linear forwards`;
                document.body.appendChild(el);
                el.addEventListener('animationend', () => el.remove());
            },
            spawnBoom() {
                const icon = produceItems[Math.floor(Math.random() * produceItems.length)].icon;
                const el = document.createElement('div');
                el.className = 'boom-emoji';
                el.textContent = icon;
                el.style.left = `${Math.random() * 90 + 3}%`;
                el.style.top = `${Math.random() * 80 + 10}vh`;
                const duration = 0.7 + Math.random() * 0.8;
                el.style.animation = `boom ${duration}s ease-out forwards`;
                el.style.fontSize = `${20 + Math.random() * 40}px`;
                document.body.appendChild(el);
                el.addEventListener('animationend', () => el.remove());
            }
        };

        document.addEventListener('DOMContentLoaded', app.init);

        window.addEventListener("load", () => {
            const loader = document.getElementById("loader");
            loader.style.opacity = "0";
            loader.style.pointerEvents = "none";
            setTimeout(() => loader.remove(), 300);
        });

        /* --- Android / Browser Back Integration (history-based SPA navigation) --- */
        (function () {
            const BACK_SELECTOR = 'button[onclick^="app.goHome"]';

            // Make sure we have a base 'home' state
            try { history.replaceState({ app: 'veggie', view: 'home' }, '', location.pathname + location.search + location.hash); } catch (e) { }

            function pushViewState(view, data, url) {
                const state = { app: 'veggie', view: view, data: data || {} };
                const href = typeof url === 'string' ? url : ('#' + view + (data && data.id ? '/' + data.id : ''));
                try { history.pushState(state, '', href); } catch (err) { /* ignore */ }
            }

            window.veggieHistory = { pushViewState };

            // Prevent recursion when we programmatically click in-site back
            let suppressBackClick = false;

            // Intercept in-site back button clicks (e.g. app.goHome()) to use history.back()
            document.addEventListener('click', function (e) {
                const btn = e.target.closest(BACK_SELECTOR);
                if (!btn) return;
                if (suppressBackClick) { suppressBackClick = false; return; }
                e.preventDefault();
                history.back();
            }, { passive: false });

            // Map popstate entries to app behavior
            window.addEventListener('popstate', function (e) {
                const s = e.state;
                if (!s || s.app !== 'veggie') return; // let browser handle non-app states (exit)

                const marketView = document.getElementById('view-market');
                const aboutOverlay = document.getElementById('about-overlay');
                const imageModal = document.getElementById('image-modal');

                if (s.view === 'home') {
                    if (marketView && !marketView.classList.contains('hidden')) {
                        app.goHome();
                    } else if (aboutOverlay && !aboutOverlay.classList.contains('hidden')) {
                        app.toggleAbout();
                    } else if (imageModal && (imageModal.classList.contains('active') || !imageModal.classList.contains('hidden'))) {
                        app.closeModal();
                    }
                    return;
                }

                if (s.view === 'market') {
                    if (marketView && marketView.classList.contains('hidden')) {
                        app.showMarket(s.data && s.data.id ? s.data.id : undefined, true);
                    }
                    return;
                }

                if (s.view === 'modal') {
                    if (s.data && s.data.type === 'image' && s.data.src) {
                        app.openModal(s.data.src, s.data.marketName || '', s.data.dateStr || '');
                    }
                    return;
                }

                if (s.view === 'about') {
                    if (aboutOverlay && aboutOverlay.classList.contains('hidden')) {
                        app.toggleAbout();
                    }
                    return;
                }
            });
        })();

    </script>
</body>

</html>